(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{som0:function(e,t,a){"use strict";var l=a("TqRt"),n=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var r=l(a("wCAj"));a("+L6B");var d=l(a("2/Rp"));a("IzEo");var o=l(a("bx4M"));a("14J3");var c=l(a("BMrR"));a("jCWc");var i=l(a("kPKH"));a("/zsF");var u=l(a("PArb")),f=l(a("lwsE")),s=l(a("W8MJ")),m=l(a("a1gu")),v=l(a("Nsbk")),p=l(a("7W2i"));a("2qtc");var E=l(a("kLXV"));a("T2oS");var g=l(a("W9HT"));a("iQDF");var b=l(a("+eQT"));a("giR+");var y=l(a("fyUT")),h=l(a("pVnL"));a("y8nQ");var M=l(a("Vl3Y")),R=n(a("q1tI")),L=a("MuoO"),w=l(a("wd/R"));a("XDpg");var C,S,k,x=l(a("usdK")),N=l(a("KGTK")),T=a("4ZfN"),I=a("AvXd"),A=l(a("A4CJ")),Y=l(a("mDQx")),B=l(a("mNfy"));w.default.locale("zh-cn");var D=M.default.Item,F=M.default.create()(function(e){var t=e.form,a=e.reciveModal,l=e.showReciveModal,n=e.itemRecord,r=e.handleAddRecive,d=e.reciveModalLoading,o=e.titleArr,c=e.reciveNot,i={labelCol:{span:7},wrapperCol:{span:13}},u="{}"===JSON.stringify(n)?"\u65b0\u5efa".concat(o[1]):"\u7f16\u8f91".concat(o[1]),f="{}"===JSON.stringify(n)?"insert":"update";return R.default.createElement(E.default,{destroyOnClose:!0,title:u,visible:a,maskClosable:!1,style:{paddingBottom:"200px"},onOk:function(){return r(e,f,n.receivablesplanid)},onCancel:function(){return l(!1,{})}},R.default.createElement(g.default,{spinning:d},R.default.createElement(M.default,{layout:"inline",className:A.default.addForm},R.default.createElement(D,(0,h.default)({label:"\u672a".concat(o[1],"\u91d1\u989d")},i),R.default.createElement("div",null,(0,T.filterRMB)(c[0],"formatter"))),R.default.createElement(D,(0,h.default)({label:"\u91d1\u989d"},i),t.getFieldDecorator("money",{initialValue:n.money?n.money:0,rules:[{required:!0,message:"\u6b64\u9879\u5fc5\u586b\uff01"}]})(R.default.createElement(y.default,{style:{width:"100%"},step:100,min:0,formatter:function(e){return(0,T.filterRMB)(e,"formatter")},parser:function(e){return(0,T.filterRMB)(e,"parser")}}))),R.default.createElement(D,(0,h.default)({label:"".concat(o[1],"\u65e5\u671f")},i),t.getFieldDecorator("receivablesplandateLong",{initialValue:n.receivablesplandateLong?(0,w.default)(n.receivablesplandateLong):null,rules:[{required:!0,message:"\u6b64\u9879\u5fc5\u586b\uff01"}]})(R.default.createElement(b.default,null))))))}),O=M.default.create()(function(e){var t=e.removeModal,a=e.showRemoveModal,l=e.handleRemove,n=e.removeModalLoading,r=e.titleArr,d={text:"".concat(r[0]),removeDispatch:"receivableplan/receivableplanRemove"},o="\u5220\u9664".concat(d.text,"\u8bb0\u5f55");return R.default.createElement(E.default,{destroyOnClose:!0,title:o,visible:t,maskClosable:!1,style:{paddingBottom:"200px"},onOk:function(){return l()},onCancel:function(){return a(!1,"",{})}},R.default.createElement(g.default,{spinning:n},R.default.createElement("div",null,R.default.createElement("p",null,"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u6761".concat(d.text,"\u8bb0\u5f55\u5417\uff1f")))))}),q=(C=(0,L.connect)(function(e){var t=e.contractdata,a=e.receivableplan;return{contractdata:t,receivableplan:a}}),S=M.default.create(),C(k=S(k=function(e){function t(){var e,a;(0,f.default)(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=(0,m.default)(this,(e=(0,v.default)(t)).call.apply(e,[this].concat(n))),a.state={loading:!1,urlParams:"",reciveLoading:!1,reciveModal:!1,reciveModalLoading:!1,provisionalId:"",removeModal:!1,removeModalLoading:!1,infoSource:{},reciveSource:[],itemRecord:{},contractType:"",totalMount:[0,0]},a.finishWork=function(){var e=a.state.urlParams;x.default.push({pathname:"/compact/contract-add/result",query:{contractid:e.contractid}})},a.showReciveModal=function(e,t){var l=a.props.dispatch;"{}"===JSON.stringify(t)?a.setState({reciveModal:!!e,itemRecord:t}):(a.setState({reciveModal:!!e,reciveModalLoading:!0}),l({type:"receivableplan/infoRecive",payload:{receivablesplanid:t.receivablesplanid}}).then(function(e){e.statusCode?E.default.error({title:"\u9519\u8bef\u4fe1\u606f",content:"\u670d\u52a1\u7aef\u9519\u8bef\uff0c\u9519\u8bef\u4ee3\u7801\uff1a ".concat(e.statusCode)}):a.setState({itemRecord:e.data}),a.setState({reciveModalLoading:!1})}))},a.showRemoveModal=function(e,t,l){var n=l.receivablesplanid;a.setState({removeModal:!!e,provisionalId:n})},a.publicGetRecive=function(){var e=a.props,t=e.dispatch,l=e.location;t({type:"receivableplan/getRecive",payload:{contractid:l.query.contractid}}).then(function(e){if(e.statusCode)E.default.error({title:"\u9519\u8bef\u4fe1\u606f",content:"\u670d\u52a1\u7aef\u9519\u8bef\uff0c\u9519\u8bef\u4ee3\u7801\uff1a ".concat(e.statusCode)}),a.setState({reciveLoading:!1});else{var t=e.list;t.map(function(e,a){return t[a].itemIndex=a+1,a}),a.setState({reciveSource:t,reciveLoading:!1})}})},a.handleAddRecive=function(e,t,l){var n=e.form,r=a.props.dispatch,d=a.state.urlParams;n.validateFields(function(e,n){if(!e){var o=n,c="receivableplan/addRecive";o.contractid=d.contractid,o.receivablesplandateLong&&(o.receivablesplandateLong=(0,w.default)(o.receivablesplandateLong).valueOf()),"update"===t&&(c="receivableplan/updateRecive",o.receivablesplanid=l),a.setState({reciveModalLoading:!0}),r({type:c,payload:o}).then(function(e){e.statusCode?E.default.error({title:"\u9519\u8bef\u4fe1\u606f",content:"\u670d\u52a1\u7aef\u9519\u8bef\uff0c\u9519\u8bef\u4ee3\u7801\uff1a ".concat(e.statusCode)}):E.default.success({title:"\u64cd\u4f5c\u4fe1\u606f",content:e.msg,onOk:function(){a.setState({reciveLoading:!0,reciveModal:!1}),a.publicGetRecive()}}),a.setState({reciveModalLoading:!1})})}})},a.handleRemove=function(){var e=a.props.dispatch,t=a.state.provisionalId,l={};l.receivablesplanid=t;var n="receivableplan/removeRecive";a.setState({removeModalLoading:!0}),e({type:n,payload:l}).then(function(e){e.statusCode?E.default.error({title:"\u9519\u8bef\u4fe1\u606f",content:"\u670d\u52a1\u7aef\u9519\u8bef\uff0c\u9519\u8bef\u4ee3\u7801\uff1a ".concat(e.statusCode)}):E.default.success({title:"\u64cd\u4f5c\u4fe1\u606f",content:"\u5220\u9664\u6210\u529f\uff01",onOk:function(){a.setState({reciveLoading:!0,removeModal:!1}),a.publicGetRecive()}}),a.setState({removeModalLoading:!1})})},a}return(0,p.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.dispatch,l=t.location;this.setState({urlParams:l.query,loading:!0}),a({type:"contractdata/getInfo",payload:{contractid:l.query.contractid}}).then(function(t){t.statusCode?(E.default.error({title:"\u9519\u8bef\u4fe1\u606f",content:"\u670d\u52a1\u7aef\u9519\u8bef\uff0c\u9519\u8bef\u4ee3\u7801\uff1a ".concat(t.statusCode)}),e.setState({loading:!1})):(e.setState({infoSource:t.data,loading:!1,contractType:t.data.bigcategory,totalMount:[t.data.totalprice,100]}),e.publicGetRecive())})}},{key:"render",value:function(){var e=this,t=this.state,a=t.infoSource,l=t.reciveSource,n=t.loading,f=t.reciveModal,s=t.reciveLoading,m=t.reciveModalLoading,v=t.removeModal,p=t.removeModalLoading,E=t.itemRecord,b=t.contractType,y=t.totalMount,L=this.props.rowKey,C={md:12,sm:24},S={labelCol:{span:7},wrapperCol:{span:13}},k=y.concat([]),x=[];x="1"===b?["\u5f00\u7968","\u8ba1\u5212\u56de\u6b3e"]:["\u6536\u7968","\u8ba1\u5212\u4ed8\u6b3e"];var q={reciveModal:f,reciveModalLoading:m,itemRecord:E,titleArr:x,reciveNot:k},P={showReciveModal:this.showReciveModal,handleAddRecive:this.handleAddRecive},J={removeModal:v,removeModalLoading:p,titleArr:x},W={showRemoveModal:this.showRemoveModal,handleRemove:this.handleRemove},K=[];if(l.length){var V=0,G=0;l.forEach(function(e){V+=Number(e.money),G+=Number(e.moneypercent)}),G=G.toFixed(2),k[0]=y[0]-V,k[1]=(y[1]-G).toFixed(2),K=l.concat({itemIndex:"\u603b\u8ba1",receivablesplanid:"total",money:V,moneypercent:G})}var Q=function(e,t,a){var n={children:e,props:{}};return a===l.length&&(n.props.colSpan=0),n},j=[{title:"\u5e8f\u53f7",dataIndex:"itemIndex",key:"itemIndex",render:function(e,t,a){return a===l.length?{children:R.default.createElement("span",{style:{fontWeight:600}},"\u603b\u8ba1"),props:{colSpan:1}}:e}},{title:"\u91d1\u989d",dataIndex:"money",key:"money",render:function(e){return Q((0,T.filterRMB)(e,"formatter"))}},{title:"\u6bd4\u7387",dataIndex:"moneypercent",key:"moneypercent",render:function(e){return Q("".concat(e,"%"))}},{title:"".concat(x[1],"\u65e5\u671f"),dataIndex:"receivablesplandate",key:"receivablesplandate",render:function(e){return Q(e?(0,w.default)(e).format("YYYY-MM-DD"):null)}},{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"updatetime",key:"updatetime",render:function(e){return Q(e?(0,w.default)(e).format("YYYY-MM-DD"):null)}},{title:"\u64cd\u4f5c",render:function(t,a,n){return n<l.length&&R.default.createElement(R.Fragment,null,R.default.createElement("a",{style:{whiteSpace:"nowrap"},onClick:function(){return e.showReciveModal(!0,a)}},"\u7f16\u8f91"),R.default.createElement(u.default,{type:"vertical"}),R.default.createElement("a",{style:{color:"red",whiteSpace:"nowrap"},onClick:function(){return e.showRemoveModal(!0,"recive",a)}},"\u5220\u9664"))}}];return R.default.createElement("div",{style:{marginTop:"24px"}},R.default.createElement(o.default,{bordered:!1,className:Y.default.retCard},R.default.createElement(g.default,{spinning:n},R.default.createElement(M.default,{layout:"inline",className:[A.default.addForm,Y.default.showParams]},R.default.createElement("h3",{className:A.default.inputBlockTitle},"\u5408\u540c\u6982\u51b5"),R.default.createElement(c.default,null,R.default.createElement(i.default,{className:B.default.lineTextarea},R.default.createElement(D,{label:"\u5408\u540c\u540d\u79f0"},R.default.createElement("div",null,a.contractname))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u5408\u540c\u7f16\u53f7"},S),R.default.createElement("div",null,a.contractno))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u4e1a\u52a1\u7c7b\u578b"},S),R.default.createElement("div",null,(0,I.businesstypeFilter)(a.businesstype)))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u5408\u540c\u5927\u7c7b"},S),R.default.createElement("div",null,"1"===a.bigcategory?"\u6536\u5165\u5408\u540c":"\u652f\u51fa\u5408\u540c"))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u5408\u540c\u5c0f\u7c7b"},S),R.default.createElement("div",null,(0,I.smallcategoryFilter)(a.smallcategory)))),R.default.createElement(i.default,{className:B.default.lineTextarea},R.default.createElement(D,{label:"\u5408\u4f5c\u65b9"},R.default.createElement("div",null,a.suppliername))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u5408\u4f5c\u65b9\u8d1f\u8d23\u4eba"},S),R.default.createElement("div",null,a.supplierresponsibleperson))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u8054\u7cfb\u7535\u8bdd"},S),R.default.createElement("div",null,a.suppliertelephone))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u8d23\u4efb\u90e8\u95e8"},S),R.default.createElement("div",null,a.responsibledepartment))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u7ecf\u529e\u4eba"},S),R.default.createElement("div",null,a.responsibleperson))),"1"===a.bigcategory?"":R.default.createElement(i.default,{className:B.default.lineTextarea},R.default.createElement(D,{label:"\u5408\u540c\u5173\u8054\u60c5\u51b5"},R.default.createElement("div",null,""===a.relatedcontractname?"\u65e0":a.relatedcontractname)))),R.default.createElement("h3",{className:A.default.inputBlockTitle},"\u5408\u540c\u6761\u6b3e"),R.default.createElement(c.default,null,R.default.createElement(i.default,{className:B.default.lineTextarea},R.default.createElement(D,{label:"\u5408\u540c\u6807\u7684"},R.default.createElement("div",null,a.contractcontent))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u6570\u91cf"},S),R.default.createElement("div",null,a.measurementnumber))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u8ba1\u91cf\u5355\u4f4d"},S),R.default.createElement("div",null,a.measurementunit))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u5355\u4ef7"},S),R.default.createElement("div",null,(0,T.filterRMB)(a.unitprice,"formatter")))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u603b\u6570\u989d"},S),R.default.createElement("div",null,(0,T.filterRMB)(a.totalprice,"formatter")))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u7b7e\u7ea6\u65e5\u671f"},S),R.default.createElement("div",null,a.signingdateLong?(0,w.default)(a.signingdateLong).format("YYYY-MM-DD"):null))),R.default.createElement(i.default,C,R.default.createElement(D,(0,h.default)({label:"\u5f00\u59cb\u4e0e\u7ed3\u675f\u65e5\u671f"},S),R.default.createElement("div",null,a.begindateLong&&a.enddateLong?(0,T.rangeConcat)(a.begindateLong,a.enddateLong):null))))))),R.default.createElement(o.default,{style:{marginTop:"24px"},bordered:!1,title:x[1],className:Y.default.retCard},R.default.createElement("div",null,R.default.createElement(d.default,{icon:"plus",type:"primary",onClick:function(){return e.showReciveModal(!0,{})}},"\u65b0\u589e".concat(x[1])),R.default.createElement(N.default,{titleArr:["\u672a".concat(x[1],"\u91d1\u989d"),"\u672a".concat(x[1],"\u6bd4\u7387")],dataNot:[(0,T.filterRMB)(k[0],"formatter"),"".concat(k[1],"%")]}),R.default.createElement(r.default,{loading:s,pagination:!1,rowKey:L||"receivablesplanid",dataSource:K,columns:j})),R.default.createElement("div",{style:{textAlign:"center",marginTop:"16px"}},R.default.createElement(d.default,{type:"primary",onClick:function(){return e.finishWork()}},"\u5b8c\u6210"))),R.default.createElement(F,(0,h.default)({},q,P)),R.default.createElement(O,(0,h.default)({},J,W)))}}]),t}(R.default.PureComponent))||k)||k),P=q;t.default=P}}]);